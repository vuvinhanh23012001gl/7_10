<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Th√¥ng tin ph·∫ßn m·ªÅm</title>
<style>
/* ---------- Overlay (t∆∞∆°ng t·ª± tr∆∞·ªõc) ---------- */
#overlay_config_software {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.6);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  font-family: "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
}

/* ---------- Khung ch√≠nh ---------- */
#settings-box {
  width: 920px;
  max-width: calc(100% - 40px);
  background: linear-gradient(145deg,#1e1e1e,#2b2b2b);
  border-radius: 14px;
  padding: 18px;
  color: #f1f1f1;
  box-shadow: 0 8px 30px rgba(0,0,0,0.6);
  display: grid;
  grid-template-columns: 360px 1fr;
  gap: 18px;
}

/* ---------- Ti√™u ƒë·ªÅ ---------- */
#settings-title {
  grid-column: 1 / -1;
  font-size: 1.4rem;
  color: #00bcd4;
  margin: 6px 0 8px 0;
  font-weight: 600;
  text-shadow: 0 0 6px rgba(0,188,212,0.12);
}

/* ---------- C·ªôt tr√°i: Th√¥ng tin & c·∫•u h√¨nh ---------- */
#left-panel {
  background: rgba(255,255,255,0.02);
  border: 1px solid rgba(255,255,255,0.03);
  padding: 12px;
  border-radius: 10px;
  height: 100%;
  box-sizing: border-box;
}

/* box header nh·ªè */
#info-title {
  font-size: 1.05rem;
  color: #00e676;
  margin-bottom: 10px;
}

/* d√≤ng th√¥ng tin */
#info-list {
  display: grid;
  grid-template-columns: 1fr;
  gap: 8px;
}

#info-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px;
  border-radius: 8px;
  background: rgba(0,0,0,0.18);
  border: 1px solid rgba(255,255,255,0.02);
  color: #dfeff3;
  font-size: 0.95rem;
}

/* nh√£n */
#info-item span:first-child {
  color: #cdeef6;
  opacity: 0.95;
}

/* gi√° tr·ªã */
#info-item span:last-child {
  color: #fff;
  font-weight: 600;
}

/* c·∫•u h√¨nh (switch + inputs) */
#config-title {
  margin-top: 14px;
  font-size: 1.02rem;
  color: #00bcd4;
}

#config-block {
  margin-top: 8px;
  display: grid;
  gap: 10px;
}

/* t·ª´ng d√≤ng c·∫•u h√¨nh */
#cfg-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px;
  background: rgba(0,0,0,0.12);
  border-radius: 8px;
}

/* input text */
#field-line, #field-factory {
  width: 100%;
  padding: 8px;
  background: #2b2b2b;
  border: 1px solid #444;
  border-radius: 8px;
  color: #fff;
  outline: none;
  box-sizing: border-box;
}

/* n√∫t nh·ªè */
#export-csv, #close-settings {
  width: 100%;
  padding: 8px;
  border-radius: 8px;
  border: none;
  cursor: pointer;
  font-weight: 600;
  margin-top: 6px;
}

/* xu·∫•t csv */
#export-csv {
  background: linear-gradient(90deg,#00bcd4,#00e676);
  color: #042027;
}

/* ƒë√≥ng */
#close-settings {
  background: #333;
  color: #e8e8e8;
}

/* ---------- C·ªôt ph·∫£i: B·∫£ng log ---------- */
#right-panel {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

/* header area tr√™n b·∫£ng */
#log-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

#log-title {
  color: #ffd54f;
  font-weight: 700;
}

/* filter input */
#filter-input {
  padding: 8px;
  border-radius: 8px;
  border: 1px solid #444;
  background: #222;
  color: #fff;
}

/* b·∫£ng log */
#log-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 0.92rem;
}

#log-table thead th {
  text-align: left;
  padding: 10px;
  background: rgba(255,255,255,0.03);
  color: #cfeff8;
  font-weight: 700;
  border-bottom: 1px solid rgba(255,255,255,0.04);
}

#log-table tbody td {
  padding: 10px;
  border-bottom: 1px solid rgba(255,255,255,0.02);
  color: #e6f7fb;
  vertical-align: middle;
}

/* h√†ng hover */
#log-table tbody tr:hover td {
  background: rgba(255,255,255,0.02);
}

/* responsive: chuy·ªÉn 1 c·ªôt tr√™n m√†n nh·ªè */
@media (max-width: 880px) {
  #settings-box {
    grid-template-columns: 1fr;
  }
}
</style>
</head>
<body>
<div id="overlay_config_software" style="display:flex;">
  <div id="settings-box">
    <h2 id="settings-title">‚öôÔ∏è Th√¥ng tin & Log ph·∫ßn m·ªÅm</h2>

    <!-- LEFT -->
    <div id="left-panel">
      <div id="info-title">Th√¥ng tin ph·∫ßn m·ªÅm</div>

      <div id="info-list">
        <div id="info-item"><span>Phi√™n b·∫£n</span><span id="info-version">v1.2.3</span></div>
        <div id="info-item"><span>Uptime</span><span id="info-uptime">00:00:00</span></div>
        <div id="info-item"><span>Last update</span><span id="info-lastupdate">2025-10-07 08:00</span></div>
        <div id="info-item"><span>Folder log</span><span id="info-logpath">/var/logs/retraining</span></div>
        <div id="info-item"><span>S·ªë b·∫£n ghi</span><span id="info-count">0</span></div>
      </div>

      <div id="config-title">C·∫•u h√¨nh</div>
      <div id="config-block">
        <div id="cfg-row">
          <div>Log h√¨nh ·∫£nh</div>
          <label id="switch-log-image">
            <input type="checkbox" id="set-log-image" checked>
            <span id="slider-log-image" style="display:none;"></span>
          </label>
        </div>

        <div id="cfg-row">
          <div>Log s·∫£n ph·∫©m</div>
          <label id="switch-log-product">
            <input type="checkbox" id="set-log-product" checked>
            <span id="slider-log-product" style="display:none;"></span>
          </label>
        </div>

        <div id="cfg-row">
          <div>Log ph·∫ßn m·ªÅm</div>
          <label id="switch-log-software">
            <input type="checkbox" id="set-log-software" checked>
            <span id="slider-log-software" style="display:none;"></span>
          </label>
        </div>

        <div id="cfg-row" style="flex-direction:column; align-items:flex-start;">
          <label for="field-line" id="label-line">T√™n truy·ªÅn</label>
          <input id="field-line" type="text" placeholder="VD: Truy·ªÅn A">
        </div>

        <div id="cfg-row" style="flex-direction:column; align-items:flex-start;">
          <label for="field-factory" id="label-factory">T√™n nh√† m√°y</label>
          <input id="field-factory" type="text" placeholder="VD: Nh√† m√°y B·∫Øc Ninh">
        </div>

        <button id="export-csv" title="Xu·∫•t file CSV t·ª´ log hi·ªÉn th·ªã">üì§ Xu·∫•t log CSV</button>
        <button id="close-settings">‚úñ ƒê√≥ng</button>
      </div>
    </div>

    <!-- RIGHT (log) -->
    <div id="right-panel">
      <div id="log-header">
        <div id="log-title">B·∫£ng Log</div>
        <div>
          <input id="filter-input" placeholder="T√¨m: event / status / time" />
        </div>
      </div>

      <div id="log-table-wrap" style="overflow:auto; max-height:420px;">
        <table id="log-table">
          <thead>
            <tr>
              <th>Th·ªùi gian</th>
              <th>S·ª± ki·ªán</th>
              <th>Tr·∫°ng th√°i</th>
            </tr>
          </thead>
          <tbody id="log-body">
            <!-- JS s·∫Ω render log t·∫°i ƒë√¢y -->
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<script>
/* M·∫™U D·ªÆ LI·ªÜU LOG - trong th·ª±c t·∫ø b·∫°n s·∫Ω load t·ª´ server ho·∫∑c t·ª´ localStorage */
const logs = [
  {time: "2025-10-07 08:30:12", event: "Retraining Start", status: "OK"},
  {time: "2025-10-07 08:31:02", event: "Capture image #123", status: "Saved"},
  {time: "2025-10-07 08:31:22", event: "Inference - product A", status: "NG"},
  {time: "2025-10-07 08:32:10", event: "Retraining Done", status: "Success"}
];

/* Render b·∫£ng log */
function renderLogs(list) {
  const tbody = document.getElementById("log-body");
  tbody.innerHTML = "";
  list.forEach(l => {
    const tr = document.createElement("tr");
    const tdTime = document.createElement("td");
    const tdEvent = document.createElement("td");
    const tdStatus = document.createElement("td");
    tdTime.textContent = l.time;
    tdEvent.textContent = l.event;
    tdStatus.textContent = l.status;
    tr.appendChild(tdTime);
    tr.appendChild(tdEvent);
    tr.appendChild(tdStatus);
    tbody.appendChild(tr);
  });
  document.getElementById("info-count").textContent = list.length;
}

/* TƒÉng uptime ƒë∆°n gi·∫£n (demo) */
let start = Date.now();
function updateUptime(){
  const sec = Math.floor((Date.now() - start)/1000);
  const h = String(Math.floor(sec/3600)).padStart(2,"0");
  const m = String(Math.floor((sec%3600)/60)).padStart(2,"0");
  const s = String(sec%60).padStart(2,"0");
  document.getElementById("info-uptime").textContent = `${h}:${m}:${s}`;
}

/* Xu·∫•t CSV (v·ªõi BOM ƒë·ªÉ Excel hi·ªán ti·∫øng Vi·ªát t·ªët) */
function exportCSV(list){
  if (!list || list.length === 0){ alert("Kh√¥ng c√≥ log ƒë·ªÉ xu·∫•t!"); return; }
  const header = Object.keys(list[0]).join(",") + "\n";
  // escape d·∫•u ph·∫©y v√† d√≤ng m·ªõi n·∫øu c·∫ßn: wrap by quotes and double quotes inside
  const rows = list.map(obj => {
    return Object.values(obj).map(v => {
      const s = String(v);
      if (s.includes(",") || s.includes("\n") || s.includes('"')) {
        return `"${s.replace(/"/g,'""')}"`;
      }
      return s;
    }).join(",");
  }).join("\n");
  const csv = "\uFEFF" + header + rows;
  const blob = new Blob([csv], {type: "text/csv;charset=utf-8;"});
  const link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = "log_retraining.csv";
  link.click();
  URL.revokeObjectURL(link.href);
}

/* T√¨m/filter */
document.getElementById("filter-input").addEventListener("input", function(){
  const q = this.value.trim().toLowerCase();
  if (!q) { renderLogs(logs); return; }
  const filtered = logs.filter(l =>
    l.time.toLowerCase().includes(q) ||
    l.event.toLowerCase().includes(q) ||
    l.status.toLowerCase().includes(q)
  );
  renderLogs(filtered);
});

/* N√∫t Xu·∫•t CSV */
document.getElementById("export-csv").addEventListener("click", () => {
  // xu·∫•t theo filter hi·ªán t·∫°i
  const q = document.getElementById("filter-input").value.trim().toLowerCase();
  const toExport = q ? logs.filter(l =>
    l.time.toLowerCase().includes(q) ||
    l.event.toLowerCase().includes(q) ||
    l.status.toLowerCase().includes(q)
  ) : logs;
  exportCSV(toExport);
});

/* N√∫t ƒë√≥ng (·∫©n overlay) */
document.getElementById("close-settings").addEventListener("click", () => {
  document.getElementById("overlay_config_software").style.display = "none";
});

/* Kh·ªüi t·∫°o hi·ªÉn th·ªã */
renderLogs(logs);
setInterval(updateUptime, 1000);

/* G√°n m·ªôt s·ªë th√¥ng tin demo - trong th·ª±c t·∫ø b·∫°n load t·ª´ server */
document.getElementById("info-version").textContent = "v1.2.3";
document.getElementById("info-lastupdate").textContent = "2025-10-07 08:00";
document.getElementById("info-logpath").textContent = "/var/logs/retraining";

/* L∆∞u c·∫•u h√¨nh t·∫°m v√†o localStorage khi thay ƒë·ªïi input (v√≠ d·ª•) */
document.getElementById("field-line").value = localStorage.getItem("cfg_line") || "Truy·ªÅn A";
document.getElementById("field-factory").value = localStorage.getItem("cfg_factory") || "Nh√† m√°y B·∫Øc Ninh";
document.getElementById("field-line").addEventListener("change", e => localStorage.setItem("cfg_line", e.target.value));
document.getElementById("field-factory").addEventListener("change", e => localStorage.setItem("cfg_factory", e.target.value));
</script>
</body>
</html>
