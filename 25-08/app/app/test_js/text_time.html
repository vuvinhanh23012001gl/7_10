<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta charset="UTF-8">
<title>Tiến trình xử lý sản phẩm</title>
<style>
body {
  font-family: 'Segoe UI', sans-serif;
  text-align: center;
  padding: 50px 20px;
  background: #f0f3f7;
}

h2 {
  margin-bottom: 20px;
  color: #333;
}

/* ===== Container thanh load ===== */
#progress-container {
  display: flex;
  justify-content: center;
  align-items: center;
  border: 2px solid #bbb;
  border-radius: 20px;
  padding: 12px;
  background: white;
  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
  max-width: 90%;
  margin: 0 auto 20px;
}

/* ===== Hàng ô vuông ===== */
#progress-row {
  display: flex;
  flex-wrap: wrap;       /* xuống dòng tự động */
  gap: 6px;              /* khoảng cách giữa các ô */
  justify-content: center; 
}

/* ===== Ô vuông nhỏ ===== */
.progress-box {
  width: 30px;           /* cố định */
  height: 30px;          /* cố định */
  background-color: #ffc107; /* vàng khi chưa xử lý */
  border-radius: 6px;
  border: 1px solid #aaa;
  transition: background-color 0.4s, transform 0.2s;
  flex-shrink: 0;        /* không bị co khi container hẹp */
}

/* ===== Khi ảnh/sản phẩm đã xử lý xong ===== */
.progress-box.done {
  background-color: #4caf50; /* xanh lá */
  border-color: #3e8e41;
}

/* ===== Hover hiệu ứng ===== */
.progress-box:hover {
  transform: scale(1.1);
  border-color: #2196f3;
}

button {
  margin-top: 20px;
  padding: 10px 22px;
  font-size: 16px;
  border: none;
  background: #2196f3;
  color: white;
  border-radius: 8px;
  cursor: pointer;
  transition: background 0.3s;
}

button:hover:not(:disabled) {
  background: #1976d2;
}

button:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

#time-display, #product-count {
  margin-top: 15px;
  font-size: 18px;
  font-weight: 500;
  color: #444;
}
</style>
</head>
<body>

<h2>Tiến trình xử lý sản phẩm</h2>

<div id="progress-container">
  <div id="progress-row"></div>
</div>

<button id="btn-start">Bắt đầu xử lý</button>

<div id="time-display">Thời gian chạy: 0.0 s</div>
<div id="product-count">OKE: 0 | EG: 0</div>

<script>
const totalImagesPerProduct = 5; // số ảnh mỗi sản phẩm
const totalProducts = 2; // số sản phẩm cần xử lý

const progressRow = document.getElementById('progress-row');
const btnStart = document.getElementById('btn-start');
const timeDisplay = document.getElementById('time-display');
const productCount = document.getElementById('product-count');

let timerInterval = null;

// Tạo ô vuông tương ứng số ảnh của 1 sản phẩm (lặp lại cho toàn bộ sản phẩm)
function createProgressBoxes(totalImages) {
  progressRow.innerHTML = '';
  for (let i = 0; i < totalImages; i++) {
    const box = document.createElement('div');
    box.className = 'progress-box';
    progressRow.appendChild(box);
  }
}

// Format thời gian
function formatTime(ms) {
  return (ms/1000).toFixed(1);
}

// Giả lập xử lý sản phẩm
btnStart.addEventListener('click', async () => {
  btnStart.disabled = true;

  let OKE = 0;
  let EG = 0;

  const boxes = document.querySelectorAll('.progress-box');

  let startTime = Date.now();
  timerInterval = setInterval(() => {
    let elapsed = Date.now() - startTime;
    timeDisplay.textContent = `Thời gian chạy: ${formatTime(elapsed)} s`;
  }, 100);

  for (let p = 0; p < totalProducts; p++) {
    // tạo thanh load cho sản phẩm mới
    createProgressBoxes(totalImagesPerProduct);
    const boxes = document.querySelectorAll('.progress-box');

    // giả lập xử lý từng ảnh của sản phẩm
    for (let i = 0; i < totalImagesPerProduct; i++) {
      await new Promise(res => setTimeout(res, 300)); // delay 0.3s/ảnh
      boxes[i].classList.add('done'); // đánh dấu ảnh đã xử lý
    }

    // giả lập phán định sản phẩm OKE/EG
    if (Math.random() > 0.2) OKE++; // 80% OK
    else EG++; // 20% lỗi

    productCount.textContent = `OKE: ${OKE} | EG: ${EG}`;
    await new Promise(res => setTimeout(res, 500)); // pause ngắn trước sản phẩm tiếp theo
  }

  clearInterval(timerInterval);
  let totalElapsed = Date.now() - startTime;
  timeDisplay.textContent = `Hoàn tất! Tổng thời gian: ${formatTime(totalElapsed)} s`;
  btnStart.disabled = false;
});
</script>

</body>
</html>
